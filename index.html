<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Index</title>
  <link rel="stylesheet" href="res/style.css">
</head>
<body>
  <header class="site-header">
    <nav class="main-nav">
      <a class="nav-item" href="index.html">Home</a>
      <a class="nav-item" href="addpost.html">Add Post</a>
    </nav>
    <div class="profile-icon" title="Profile">
      <a href="login.html">
        <img src="res/img/Profile.png" alt="Profile picture">
      </a>
    </div>
  </header>

  <main class="container">
    <section class="left-gutter"></section>

    <!-- Posts will be injected here -->
    <section class="feed" id="feed"></section>

    <aside class="right-gutter"></aside>
  </main>

  <footer class="site-footer" id="footer">
    Group AL
  </footer>

  <script>
    async function loadPosts() {
      const feedContainer = document.getElementById('feed');
      feedContainer.innerHTML = "<p>Loading posts...</p>";

      try {
        //const response = await fetch('https://api.jsonsilo.com/public/f543ccd5-2fd6-444a-a040-dd52012ec4c5');
		const response = await fetch('res/posts.json');
        if (!response.ok) throw new Error('Failed to fetch posts');
        const data = await response.json();
        const posts = data.posts || [];
        feedContainer.innerHTML = "";

        if (posts.length === 0) {
          feedContainer.innerHTML = "<p>No posts found.</p>";
          return;
        }

        posts.forEach(post => {
          const article = document.createElement('article');
          article.classList.add('post');

          const header = document.createElement('header');
          header.classList.add('post-header');

          const profileDiv = document.createElement('div');
          profileDiv.classList.add('profile-icon');
          const profileImg = document.createElement('img');
          profileImg.src = "res/img/Profile.png";
          profileImg.alt = "Profile picture";
          profileDiv.appendChild(profileImg);

          const authorName = document.createElement('span');
          authorName.textContent = post.author || "Unknown";
          authorName.style.marginLeft = "8px";
          authorName.style.fontWeight = "bold";

          header.appendChild(profileDiv);
          header.appendChild(authorName);
          article.appendChild(header);

          if (post.image) {
            const imageDiv = document.createElement('div');
            imageDiv.classList.add('post-image');
            const img = document.createElement('img');
            img.src = post.image;
            img.alt = post.title || "Post image";
            imageDiv.appendChild(img);
            article.appendChild(imageDiv);
          }

          const bodyDiv = document.createElement('div');
          bodyDiv.classList.add('post-body');

          const title = document.createElement('h3');
          title.textContent = post.title || "";
          title.style.marginBottom = "4px";

          const content = document.createElement('p');
          content.textContent = post.content || "";

          bodyDiv.appendChild(title);
          bodyDiv.appendChild(content);
          article.appendChild(bodyDiv);

          feedContainer.appendChild(article);
        });

      } catch (error) {
        console.error(error);
        feedContainer.innerHTML = "<p>Failed to load posts. Please try again later.</p>";
      }
    }

    document.addEventListener('DOMContentLoaded', loadPosts);
  </script>
</body>
</html>
